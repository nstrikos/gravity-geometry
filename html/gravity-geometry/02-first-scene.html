<!DOCTYPE html>

<html>

<head>
    <title>TwoBody problem in 3 Dimensions</title>
    <script type="text/javascript" src="../libs/three.js"></script>
    <script type="text/javascript" src="../libs/stats.js"></script>
    <script type="text/javascript" src="../libs/dat.gui.js"></script>
    <script type="text/javascript" src="../libs/OrbitControls.js"></script>
    <script type="text/javascript" src="../mylibs/orbit.js"></script>
    <style>
        body{
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<div id="Stats-output">
</div>

<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<!-- Javascript code that runs our Three.js examples -->
<script type="text/javascript">

    var camera;
    var scene;
    var renderer;


    var frame = 0;
    var geometry = new THREE.Geometry();
    var colors = [];
    var material = new THREE.LineBasicMaterial({
                    opacity: 1.0,
                    linewidth: 2,
                    vertexColors: THREE.VertexColors });
    var line = new THREE.Line(geometry, material);
    var geometry2 = new THREE.Geometry();
    var colors2 = [];
    var material2 = new THREE.LineBasicMaterial({
                    opacity: 1.0,
                    linewidth: 2,
                    vertexColors: THREE.VertexColors });
    var line2 = new THREE.Line(geometry2, material2);

    var geometry3 = new THREE.Geometry();
    var colors3 = [];
    var material3 = new THREE.LineBasicMaterial({
                    opacity: 1.0,
                    linewidth: 2,
                    vertexColors: THREE.VertexColors });
    var line3 = new THREE.Line(geometry3, material3);

    var geometry4 = new THREE.Geometry();
    var colors4 = [];
    var material4 = new THREE.LineBasicMaterial({
                    opacity: 1.0,
                    linewidth: 2,
                    vertexColors: THREE.VertexColors });
    var line4 = new THREE.Line(geometry4, material4);

    var geometry5 = new THREE.Geometry();
    var colors5 = [];
    var material5 = new THREE.LineBasicMaterial({
                    opacity: 1.0,
                    linewidth: 2,
                    vertexColors: THREE.VertexColors });
    var line5 = new THREE.Line(geometry5, material5);

    var earthLight = new THREE.SpotLight( 0xffffff );
    earthLight.position.set( 50, 50, 50);
    var marsLight = new THREE.SpotLight( 0xffffff );
    marsLight.position.set( 50, 50, 50);
    var venusLight = new THREE.SpotLight( 0xffffff );
    venusLight.position.set( 50, 50, 50);
    var jupiterLight = new THREE.SpotLight( 0xffffff );
    jupiterLight.position.set( 50, 50, 50);

    var sunLight1 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight2 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight3 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight4 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight5 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight6 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight7 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);
    var sunLight8 = new THREE.SpotLight( 0xffffff );
    sunLight1.position.set( 50, 50, 50);

    var gui = new dat.GUI();

    //Initial values
    var RunSimulation = true;
    var AutoRotate = true;
    var CameraFollowsSphere1 = true;
    var factor = 0.0;
    var maxDistance = 0.0;

    var m1 = 1.988e+30;
    var m2 = 5.9726e+24;
    var m3 = 0.64174e+24;
    var m4 = 4.8676e+24;
    var m5 = 1898.3e+24;
    var x = 0;
    //var xstop = 600000000;
    //Earth period
    //var xstop = 31558118.4
    //Mars period
    //var xstop = 59355072
    //Venus period
    //var xstop = 19414166.4
    //Jupiter period
    var xstop = 374335689.6

    var h = 100000;
    var G = 6.67384e-20;
    var ncolumns = 12;
    var nrows = Math.ceil ((xstop-x)/h);
    var positionVelocityArray = new Array(nrows);
    for ( i = 0; i < nrows; i++)
    {
        positionVelocityArray[i] = new Array(ncolumns);
    }
    var marsArray = new Array(nrows);
    for ( i = 0; i < nrows; i++)
    {
        marsArray[i] = new Array(ncolumns);
    }
    var venusArray = new Array(nrows);
    for ( i = 0; i < nrows; i++)
    {
        venusArray[i] = new Array(ncolumns);
    }
    var jupiterArray = new Array(nrows);
    for ( i = 0; i < nrows; i++)
    {
        jupiterArray[i] = new Array(ncolumns);
    }

    var Mass1PositionX = 0;
    var Mass1PositionY = 0;
    var Mass1PositionZ = 0;
    var Mass2PositionX = 149.6e+6;
    var Mass2PositionY = 0;
    var Mass2PositionZ = 0;
    var Mass1VelocityX = 5;
    var Mass1VelocityY = 5;
    var Mass1VelocityZ = 5;
    var Mass2VelocityX = 5;
    var Mass2VelocityY = 5;
    var Mass2VelocityZ = 5 + 29.78;
    var y = new Array();
    y[0] = Mass1PositionX;
    y[1] = Mass1PositionY;
    y[2] = Mass1PositionZ;
    y[3] = Mass2PositionX;
    y[4] = Mass2PositionY;
    y[5] = Mass2PositionZ;
    y[6] = Mass1VelocityX;
    y[7] = Mass1VelocityY;
    y[8] = Mass1VelocityZ;
    y[9] = Mass2VelocityX;
    y[10] = Mass2VelocityY;
    y[11] = Mass2VelocityZ;

    var Mass3PositionX = 0;
    var Mass3PositionY = 0;
    var Mass3PositionZ = 227.92e+6;
    var Mass3VelocityX = -24.07 + 5;
    var Mass3VelocityY = 5;
    var Mass3VelocityZ = 5;
    var w = new Array();
    w[0] = Mass1PositionX;
    w[1] = Mass1PositionY;
    w[2] = Mass1PositionZ;
    w[3] = Mass3PositionX;
    w[4] = Mass3PositionY;
    w[5] = Mass3PositionZ;
    w[6] = Mass1VelocityX;
    w[7] = Mass1VelocityY;
    w[8] = Mass1VelocityZ;
    w[9] = Mass3VelocityX;
    w[10] = Mass3VelocityY;
    w[11] = Mass3VelocityZ;

    var Mass4PositionX = -108.21e+6;
    var Mass4PositionY = 0;
    var Mass4PositionZ = 0;
    var Mass4VelocityX = 5;
    var Mass4VelocityY = 5;
    var Mass4VelocityZ = -35.02 + 5;
    var s = new Array();
    s[0] = Mass1PositionX;
    s[1] = Mass1PositionY;
    s[2] = Mass1PositionZ;
    s[3] = Mass4PositionX;
    s[4] = Mass4PositionY;
    s[5] = Mass4PositionZ;
    s[6] = Mass1VelocityX;
    s[7] = Mass1VelocityY;
    s[8] = Mass1VelocityZ;
    s[9] = Mass4VelocityX;
    s[10] = Mass4VelocityY;
    s[11] = Mass4VelocityZ;

    var Mass5PositionX = 778.57e+6;
    var Mass5PositionY = 0;
    var Mass5PositionZ = 0;
    var Mass5VelocityX = 5;
    var Mass5VelocityY = 5;
    var Mass5VelocityZ = 13.06 + 5;
    var t = new Array();
    t[0] = Mass1PositionX;
    t[1] = Mass1PositionY;
    t[2] = Mass1PositionZ;
    t[3] = Mass5PositionX;
    t[4] = Mass5PositionY;
    t[5] = Mass5PositionZ;
    t[6] = Mass1VelocityX;
    t[7] = Mass1VelocityY;
    t[8] = Mass1VelocityZ;
    t[9] = Mass5VelocityX;
    t[10] = Mass5VelocityY;
    t[11] = Mass5VelocityZ;

    for ( i = 0; i < 5 ; i++)
    {
        if (maxDistance < Math.abs(y[i]) )
            maxDistance = Math.abs(y[i])
    }
    factor = maxDistance / 9.0;

    //calculate array with positions and velocities
    rk4(x, xstop, h, y, m1, m2, G, positionVelocityArray, nrows);
    rk4(x, xstop, h, w, m1, m3, G, marsArray, nrows);
    rk4(x, xstop, h, s, m1, m4, G, venusArray, nrows);
    rk4(x, xstop, h, t, m1, m5, G, jupiterArray, nrows);

    function evaluate()
    {
        frame = 0;

        //free memory
        scene.remove(line);
        delete line;
        line = null;
        positionVelocityArray = [];
        delete positionVelocityArray;
        positionVelocityArray = null;

        y[0] = Mass1PositionX;
        y[1] = Mass1PositionY;
        y[2] = Mass1PositionZ;
        y[3] = Mass2PositionX;
        y[4] = Mass2PositionY;
        y[5] = Mass2PositionZ;
        y[6] = Mass1VelocityX;
        y[7] = Mass1VelocityY;
        y[8] = Mass1VelocityZ;
        y[9] = Mass2VelocityX;
        y[10] = Mass2VelocityY;
        y[11] = Mass2VelocityZ;
        for ( i = 0; i < 5 ; i++)
        {
            if (maxDistance < Math.abs(y[i]) )
                maxDistance = Math.abs(y[i])
        }
        factor = maxDistance / 6.0;
        nrows = Math.ceil ((xstop-x)/h);
        ncolumns = 12;
        positionVelocityArray = new Array(nrows);
        for ( i = 0; i < nrows; i++)
        {
            positionVelocityArray[i] = new Array(ncolumns);
        }
        rk4(x, xstop, h, y, m1, m2, G, positionVelocityArray, nrows);
    }


    function init() {

        var stats = initStats();

        scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
		camera.target = new THREE.Vector3(0, 0, 0);

        renderer = new THREE.WebGLRenderer();
        renderer.setClearColor(new THREE.Color(0x000000, 1.0));
        renderer.shadowMapEnabled = true;
        renderer.setSize(window.innerWidth, window.innerHeight);
     	document.body.appendChild(renderer.domElement);

        var axes = new THREE.AxisHelper( 20 );
        scene.add(axes);

        var sphere1 = createMesh(new THREE.SphereGeometry(5, 20, 20), "sun1.jpg");
        sphere1.shininess = 100;
        sphere1.name = "sphere1";
        scene.add(sphere1);

        var sphere2 = createMesh(new THREE.SphereGeometry(2, 20, 20), "unshaded1024.jpg");
        sphere2.name = "sphere2";
        scene.add(sphere2);

        var sphere3 = createMesh(new THREE.SphereGeometry(1, 20, 20), "mars_texture.jpg");
        sphere3.name = "sphere3";
        scene.add(sphere3);

        var sphere4 = createMesh(new THREE.SphereGeometry(1.2, 20, 20), "venus_texture2.jpg");
        sphere4.name = "sphere4";
        scene.add(sphere4);

        var sphere5 = createMesh(new THREE.SphereGeometry(3, 20, 20), "jupiter_texture.jpg");
        sphere5.name = "sphere5";
        scene.add(sphere5);

        // creation of a big sphere geometry
		//var sphere = new THREE.SphereGeometry(500, 100, 40);
		//sphere.applyMatrix(new THREE.Matrix4().makeScale(-1, 1, 1));

		// creation of the sphere material
		//var sphereMaterial = new THREE.MeshBasicMaterial();
        //sphereMaterial.map = THREE.ImageUtils.loadTexture("../mypics/stars-small.jpg")

        // geometry + material = mesh (actual object)
		//var sphereMesh = new THREE.Mesh(sphere, sphereMaterial);
		//scene.add(sphereMesh);

        camera.position.x = 30;
        camera.position.y = 40;
        camera.position.z = 30;
        camera.lookAt(scene.position);

        scene.add(earthLight);
        scene.add(marsLight);
        scene.add(venusLight);
        scene.add(jupiterLight);
        scene.add(sunLight1);
        scene.add(sunLight2);
        scene.add(sunLight3);
        scene.add(sunLight4);
        scene.add(sunLight5);
        scene.add(sunLight6);
        scene.add(sunLight7);
        scene.add(sunLight8);



        var orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
        orbitControls.autoRotate = AutoRotate;
        var clock = new THREE.Clock();
        document.getElementById("WebGL-output").appendChild(renderer.domElement);

        var controls = new function() {
            this.Mass1 = m1;
            this.Mass2 = m2;
            this.InitialTime = x;
            this.FinalTime = xstop;
            this.TimeStep = h;
            this.Mass1PositionX = Mass1PositionX;
            this.Mass1PositionY = Mass1PositionY;
            this.Mass1PositionZ = Mass1PositionZ;
            this.Mass2PositionX = Mass2PositionX;
            this.Mass2PositionY = Mass2PositionY;
            this.Mass2PositionZ = Mass2PositionZ;
            this.Mass1VelocityX = Mass1VelocityX;
            this.Mass1VelocityY = Mass1VelocityY;
            this.Mass1VelocityZ = Mass1VelocityZ;
            this.Mass2VelocityX = Mass2VelocityX;
            this.Mass2VelocityY = Mass2VelocityY;
            this.Mass2VelocityZ = Mass2VelocityZ;
            this.RunSimulation = RunSimulation;
            this.AutoRotate = AutoRotate;
            this.CameraFollowsSphere1 = CameraFollowsSphere1;
            this.Restart = function() {
                evaluate();
            }
            this.Back10 = function() {
                if (frame > 10)
                    frame -= 10;
                else
                    frame = 0;
            }
            this.Back = function() {
                if (frame > 1)
                    frame--;
                else
                    frame = 0;
            }
            this.Forward = function() {
                if (frame < nrows)
                    frame++;
                else
                    frame = nrows;
            }
            this.Forward10 = function() {
                if (frame < nrows - 10)
                    frame += 10;
                else
                    frame = nrows;
            }
        }

        gui.add(controls, 'Mass1').onChange(function (e) {
            m1 = e;
            evaluate();
        });
        gui.add(controls, 'Mass2').onChange(function (e) {
            m2 = e;
            evaluate();
        });
        gui.add(controls, 'InitialTime').onChange(function (e) {
            x = e;
            evaluate();
        });
        gui.add(controls, 'FinalTime').onChange(function (e) {
            xstop = e;
            evaluate();
        });
        gui.add(controls, 'TimeStep').onChange(function (e) {
            h = e;
            evaluate();
        });
        gui.add(controls, 'Mass1PositionX').onChange(function (e) {
            Mass1PositionX = e;
            evaluate();
        });
        gui.add(controls, 'Mass1PositionY').onChange(function (e) {
            Mass1PositionY = e;
            evaluate();
        });
        gui.add(controls, 'Mass1PositionZ').onChange(function (e) {
            Mass1PositionZ = e;
            evaluate();
        });
        gui.add(controls, 'Mass2PositionX').onChange(function (e) {
            Mass2PositionX = e;
            evaluate();
        });
        gui.add(controls, 'Mass2PositionY').onChange(function (e) {
            Mass2PositionY = e;
            evaluate();
        });
        gui.add(controls, 'Mass2PositionZ').onChange(function (e) {
            Mass2PositionZ = e;
            evaluate();
        });
        gui.add(controls, 'Mass1VelocityX').onChange(function (e) {
            Mass1VelocityX = e;
            evaluate();
        });
        gui.add(controls, 'Mass1VelocityY').onChange(function (e) {
            Mass1VelocityY = e;
            evaluate();
        });
        gui.add(controls, 'Mass1VelocityZ').onChange(function (e) {
            Mass1VelocityZ = e;
            evaluate();
        });
        gui.add(controls, 'Mass2VelocityX').onChange(function (e) {
            Mass2VelocityX = e;
            evaluate();
        });
        gui.add(controls, 'Mass2VelocityY').onChange(function (e) {
            Mass2VelocityY = e;
            evaluate();
        });
        gui.add(controls, 'Mass2VelocityZ').onChange(function (e) {
            Mass2VelocityZ = e;
            evaluate();
        });
        gui.add(controls, 'RunSimulation').onChange(function (e) {
            RunSimulation = e;
        });
        gui.add(controls, 'AutoRotate').onChange(function (e) {
            AutoRotate = e;
            orbitControls.autoRotate = AutoRotate;
        });
        gui.add(controls, 'CameraFollowsSphere1').onChange(function (e) {
            CameraFollowsSphere1 = e;
        });
        gui.add(controls, 'Restart');
        gui.add(controls, 'Back10');
        gui.add(controls, 'Back');
        gui.add(controls, 'Forward');
        gui.add(controls, 'Forward10');

        render();

        function createMesh(geom, imageFile) {
            var texture = THREE.ImageUtils.loadTexture("../mypics/" + imageFile)
            var mat = new THREE.MeshPhongMaterial();
            mat.map = texture;

            var mesh = new THREE.Mesh(geom, mat);
            return mesh;
        }

        function render()
        {
            stats.update();
            if (frame < positionVelocityArray.length - 1 )
            {
                if (RunSimulation == true)
                    frame++;

                //free memory
                //scene.remove(line);
                //delete line;
                //line = null;
                //scene.remove(line2);
                //delete line2;
                //line2 = null;
                //scene.remove(line3);
                //delete line3;
                //line3 = null;
                //geometry.vertices = [];
                //delete geometry;
                //geometry = null;
                //geometry = new THREE.Geometry();
                //colors = [];
                //geometry2.vertices = [];
                //delete geometry2;
                //geometry2 = null;
                //geometry2 = new THREE.Geometry();
                //colors2 = [];
                //geometry3.vertices = [];
                //delete geometry3;
                //geometry3 = null;
                //geometry3 = new THREE.Geometry();
                //colors3 = [];
                //geometry4.vertices = [];
                //delete geometry4;
                //geometry4 = null;
                //geometry4 = new THREE.Geometry();
                //colors4 = [];
                //geometry5.vertices = [];
                //delete geometry5;
                //geometry5 = null;
                //geometry5 = new THREE.Geometry();
                //colors5 = [];

                var sphere1X = positionVelocityArray[frame][0] / factor;
                var sphere1Y = positionVelocityArray[frame][1] / factor;
                var sphere1Z = positionVelocityArray[frame][2] / factor;
                var sphere2X = positionVelocityArray[frame][3] / factor;
                var sphere2Y = positionVelocityArray[frame][4] / factor;
                var sphere2Z = positionVelocityArray[frame][5] / factor;
                var sphere1Xb = marsArray[frame][0] / factor;
                var sphere1Yb = marsArray[frame][1] / factor;
                var sphere1Zb = marsArray[frame][2] / factor;
                var sphere3X = marsArray[frame][3] / factor;
                var sphere3Y = marsArray[frame][4] / factor;
                var sphere3Z = marsArray[frame][5] / factor;
                var sphere1Xc = venusArray[frame][0] / factor;
                var sphere1Yc = venusArray[frame][1] / factor;
                var sphere1Zc = venusArray[frame][2] / factor;
                var sphere4X = venusArray[frame][3] / factor;
                var sphere4Y = venusArray[frame][4] / factor;
                var sphere4Z = venusArray[frame][5] / factor;
                var sphere1Xd = jupiterArray[frame][0] / factor;
                var sphere1Yd = jupiterArray[frame][1] / factor;
                var sphere1Zd = jupiterArray[frame][2] / factor;
                var sphere5X = jupiterArray[frame][3] / factor;
                var sphere5Y = jupiterArray[frame][4] / factor;
                var sphere5Z = jupiterArray[frame][5] / factor;


                for (i=0; i < frame; i++)
                {
                    geometry.vertices.push(new THREE.Vector3( positionVelocityArray[i][0] / factor  , positionVelocityArray[i][1] / factor      ,  positionVelocityArray[i][2] / factor));
                    colors2[i] = new THREE.Color(0xffffff);
                    colors2[i].setRGB( 0.27, 0.27, 0.4*i*i/(frame*frame) + 0.6 );
                    geometry2.vertices.push(new THREE.Vector3( positionVelocityArray[i][3] / factor  , positionVelocityArray[i][4] / factor      ,  positionVelocityArray[i][5] / factor   ));
                    colors[i] = new THREE.Color(0xffffff);
                    //This is even better than qt-twobody
                    //The color now decays more quickly, not just bilinear
                    colors[i].setRGB( i*i/(frame*frame) - 0.3*i/frame + 0.3, 0.27, 0.27);
                    geometry3.vertices.push(new THREE.Vector3( marsArray[i][3] / factor, marsArray[i][4] / factor, marsArray[i][5] / factor   ));
                    colors3[i] = new THREE.Color(0xffffff);
                    colors3[i].setRGB( 0.27, 0.27, 0.4*i*i/(frame*frame) + 0.6 );
                    geometry4.vertices.push(new THREE.Vector3( venusArray[i][3] / factor, venusArray[i][4] / factor, venusArray[i][5] / factor   ));
                    colors4[i] = new THREE.Color(0xffffff);
                    colors4[i].setRGB( 0.27, 0.27, 0.4*i*i/(frame*frame) + 0.6 );
                    geometry5.vertices.push(new THREE.Vector3( jupiterArray[i][3] / factor, jupiterArray[i][4] / factor, jupiterArray[i][5] / factor   ));
                    colors5[i] = new THREE.Color(0xffffff);
                    colors5[i].setRGB( 0.27, 0.27, 0.4*i*i/(frame*frame) + 0.6 );
                }
                geometry.colors = colors;
                line = new THREE.Line(geometry, material);
                geometry2.colors = colors2;
                line2 = new THREE.Line(geometry2, material2);
                geometry3.colors = colors3;
                line3 = new THREE.Line(geometry3, material3);
                geometry4.colors = colors4;
                line4 = new THREE.Line(geometry4, material4);
                geometry5.colors = colors5;
                line5 = new THREE.Line(geometry5, material5);
                scene.add(line);
                //scene.add(line2);
                //scene.add(line3);
                //scene.add(line4);
                //scene.add(line5);

                earthLight.position.set( (sphere1X + sphere2X)/2.0  , (sphere1Y + sphere2Y)/2.0 ,  (sphere1Z + sphere2Z) / 2.0);
                earthLight.target = sphere2;
                earthLight.intensity = 5.0;
                marsLight.position.set( (sphere1Xb + sphere3X)/2.0  , (sphere1Yb + sphere3Y)/2.0 ,  (sphere1Zb + sphere3Z) / 2.0);
                marsLight.target = sphere3;
                marsLight.intensity = 5.0;
                venusLight.position.set( (sphere1Xc + sphere4X)/2.0  , (sphere1Yc + sphere4Y)/2.0 ,  (sphere1Zc + sphere4Z) / 2.0);
                venusLight.target = sphere4;
                venusLight.intensity = 5.0;
                jupiterLight.position.set( (sphere1Xd + sphere5X)/2.0  , (sphere1Yd + sphere5Y)/2.0 ,  (sphere1Zd + sphere5Z) / 2.0);
                jupiterLight.target = sphere5;
                jupiterLight.intensity = 5.0;
                sunLight1.position.set( sphere1X + 8 , sphere1Y + 8, sphere1Z + 8);
                sunLight1.target = sphere1;
                sunLight2.position.set( sphere1X - 8, sphere1Y + 8, sphere1Z + 8);
                sunLight2.target = sphere1;
                sunLight3.position.set( sphere1X - 8, sphere1Y - 8, sphere1Z + 8);
                sunLight3.target = sphere1;
                sunLight4.position.set( sphere1X + 8 , sphere1Y - 8 , sphere1Z + 8);
                sunLight4.target = sphere1;
                sunLight5.position.set( sphere1X + 8 , sphere1Y + 8, sphere1Z - 8);
                sunLight5.target = sphere1;
                sunLight6.position.set( sphere1X - 8, sphere1Y + 8, sphere1Z - 8);
                sunLight6.target = sphere1;
                sunLight7.position.set( sphere1X - 8, sphere1Y - 8, sphere1Z - 8);
                sunLight7.target = sphere1;
                sunLight8.position.set( sphere1X + 8 , sphere1Y - 8 , sphere1Z - 8);
                sunLight8.target = sphere1;

                scene.traverse(function(e) {
                    if (e.name == "sphere1" ) {
                        e.position.x = sphere1X;
                        e.position.y = sphere1Y;
                        e.position.z = sphere1Z;
                        e.rotation.y += 0.01;
                    }
                    if (e.name == "sphere2" ) {
                        e.position.x = sphere2X;
                        e.position.y = sphere2Y;
                        e.position.z = sphere2Z;
                        e.rotation.y += 0.01;
                    }
                    if (e.name == "sphere3" ) {
                        e.position.x = sphere3X;
                        e.position.y = sphere3Y;
                        e.position.z = sphere3Z;
                        e.rotation.y += 0.01;
                    }
                    if (e.name == "sphere4" ) {
                        e.position.x = sphere4X;
                        e.position.y = sphere4Y;
                        e.position.z = sphere4Z;
                        e.rotation.y += 0.01;
                    }
                    if (e.name == "sphere5" ) {
                        e.position.x = sphere5X;
                        e.position.y = sphere5Y;
                        e.position.z = sphere5Z;
                        e.rotation.y += 0.01;
                    }
                });
            }

            var delta = clock.getDelta();
            orbitControls.update(delta);

            if (CameraFollowsSphere1)
                camera.lookAt( new THREE.Vector3(positionVelocityArray[frame][0] / factor, positionVelocityArray[frame][1] / factor, positionVelocityArray[frame][2] / factor) );
            else
                camera.lookAt(scene.position);

            requestAnimationFrame(render);
            renderer.render(scene, camera);
        }

        function initStats() {

            var stats = new Stats();

            stats.setMode(0); // 0: fps, 1: ms

            // Align top-left
            stats.domElement.style.position = 'absolute';
            stats.domElement.style.left = '0px';
            stats.domElement.style.top = '0px';

            document.getElementById("Stats-output").appendChild( stats.domElement );

            return stats;
        }
    };


    function onResize()
    {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    window.onload = init;

    // listen to the resize events
    window.addEventListener('resize', onResize, false);

</script>
</body>
</html>
